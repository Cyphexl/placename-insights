# Stats-GeoNames



## Part I. Outputs

### CountryCode and Number of All Geography Features

```
[(1, 'YU'), (2, 'AN'), (2, 'CS'), (26, 'VA'), (41, 'PN'), (47, 'BV'), (60, 'CC'), (71, 'SM'), (82, 'NF'), (87, 'CX'), (97, 'HM'), (98, 'MC'), (108, 'NR'), (118, 'IO'), (118, 'TK'), (132, 'BL'), (165, 'IM'), (173, 'MO'), (198, 'SX'), (228, 'MF'), (234, 'AI'), (251, 'GI'), (280, 'UM'), (298, 'MS'), (324, 'NU'), (341, 'TV'), (366, 'KY'), (417, 'SZ'), (421, 'DM'), (462, 'BQ'), (481, 'AW'), (493, 'JE'), (498, 'CW'), (522, 'PM'), (526, 'BT'), (540, 'KN'), (550, 'SC'), (552, 'BH'), (570, 'VC'), (587, 'WF'), (616, 'TC'), (650, 'SH'), (653, 'ST'), (653, 'YT'), (669, 'BM'), (724, 'TO'), (750, 'GD'), (773, 'VG'), (775, 'AG'), (803, 'CK'), (813, 'GS'), (831, 'PW'), (850, 'GG'), (888, 'KW'), (918, 'MP'), (933, 'WS'), (942, 'BN'), (996, 'AS'), (1080, 'KI'), (1084, 'BB'), (1126, 'FK'), (1135, 'KM'), (1210, 'LU'), (1216, 'GU'), (1243, 'MV'), (1305, 'CV'), (1316, 'MH'), (1341, 'LS'), (1537, 'LC'), (1637, 'MU'), (1647, 'TF'), (1824, 'TT'), (1845, 'LI'), (1870, 'VI'), (1899, 'FO'), (1958, 'SG'), (2101, 'RE'), (2281, 'EH'), (2308, 'BZ'), (2388, 'SR'), (2408, 'GM'), (2479, 'BS'), (2502, 'MD'), (2531, 'HK'), (2587, 'PF'), (2616, 'FM'), (2913, 'MT'), (3136, 'MQ'), (3247, 'AX'), (3278, 'AD'), (3710, 'GF'), (3911, 'BW'), (3959, 'QA'), (4011, 'VU'), (4033, 'GP'), (4371, 'GQ'), (4383, 'TJ'), (5079, 'JM'), (5283, 'NC'), (5466, 'DJ'), (5539, 'SJ'), (5543, 'TM'), (5783, 'TG'), (5801, 'XK'), (5870, ''), (5897, 'BJ'), (5982, 'GY'), (6133, 'PS'), (6193, 'AE'), (6304, 'ER'), (6394, 'NI'), (6425, 'CR'), (6674, 'SV'), (6870, 'GA'), (6937, 'GW'), (7051, 'MN'), (7408, 'CY'), (7507, 'GL'), (7855, 'TL'), (7864, 'SK'), (8017, 'NA'), (8120, 'UY'), (8126, 'SI'), (8172, 'KG'), (8273, 'PR'), (8811, 'LR'), (8855, 'GE'), (8879, 'MR'), (9212, 'SB'), (9269, 'MW'), (9316, 'IL'), (9324, 'AL'), (9818, 'LV'), (9839, 'AZ'), (10115, 'CG'), (10115, 'JO'), (10120, 'UZ'), (10812, 'GN'), (11076, 'BF'), (12102, 'SS'), (12120, 'OM'), (12326, 'SN'), (14103, 'BI'), (14137, 'ME'), (15036, 'DK'), (15047, 'EE'), (15182, 'EC'), (15384, 'CF'), (15994, 'HT'), (16271, 'IS'), (16674, 'PY'), (17122, 'PA'), (17230, 'SL'), (17485, 'SO'), (17658, 'BG'), (17693, 'KH'), (17796, 'FJ'), (17843, 'CI'), (18526, 'AQ'), (19045, 'HN'), (19356, 'TZ'), (19490, 'GH'), (20254, 'BE'), (20430, 'ET'), (20732, 'RW'), (21853, 'PG'), (22146, 'LY'), (22309, 'TD'), (22772, 'NL'), (22848, 'TN'), (22901, 'CM'), (23751, 'ML'), (23820, 'GT'), (24201, 'HR'), (24271, 'NE'), (24450, 'RS'), (24480, 'HU'), (24600, 'LB'), (24813, 'ZW'), (25037, 'SA'), (25161, 'MK'), (25348, 'LA'), (26088, 'SD'), (26647, 'IE'), (26659, 'RO'), (26777, 'UG'), (28915, 'ZM'), (29794, 'BO'), (31172, 'KE'), (31298, 'BY'), (31740, 'AM'), (32443, 'EG'), (32868, 'LT'), (34785, 'CZ'), (35757, 'GR'), (36778, 'SY'), (37016, 'DO'), (37232, 'PT'), (40771, 'KZ'), (40797, 'KP'), (42018, 'UA'), (42956, 'CU'), (44394, 'CL'), (45534, 'TW'), (48995, 'MZ'), (49043, 'IQ'), (49652, 'AR'), (50036, 'AO'), (50219, 'MM'), (50898, 'MG'), (51864, 'BA'), (51995, 'AT'), (54477, 'DZ'), (56747, 'LK'), (57463, 'PL'), (59104, 'BD'), (63396, 'GB'), (65247, 'VN'), (65953, 'CD'), (66340, 'NG'), (68258, 'NZ'), (68740, 'VE'), (69227, 'MY'), (75643, 'AF'), (78069, 'CO'), (82219, 'CH'), (83935, 'YE'), (85081, 'TR'), (85351, 'ES'), (86206, 'FI'), (92350, 'PH'), (96266, 'SE'), (99096, 'JP'), (102847, 'ZA'), (104798, 'PE'), (114725, 'BR'), (118756, 'IT'), (129769, 'KR'), (134187, 'NP'), (145563, 'FR'), (152990, 'MA'), (196861, 'DE'), (212736, 'AU'), (225882, 'PK'), (235378, 'IR'), (255264, 'TH'), (313174, 'CA'), (355679, 'RU'), (384753, 'ID'), (450736, 'MX'), (603691, 'NO'), (648825, 'IN'), (775819, 'CN'), (2237466, 'US')]
```

### CountryCode and Average Placename Word Length

```
[(4.013624755151125, 'VN'), (4.767281411702268, 'HK'), (4.857667445496306, 'TH'), (5.102334007861252, 'YE'), (5.145837775957081, 'AF'), (5.1675216415517795, 'LB'), (5.195739675421346, 'LA'), (5.276809313940218, 'IR'), (5.289899625049489, 'KH'), (5.3098368498325605, 'TN'), (5.32051105921143, 'MT'), (5.328445747800586, 'BL'), (5.336961900049481, 'AD'), (5.344039530574428, 'PM'), (5.405162855887705, 'SY'), (5.414892808271248, 'OM'), (5.41924252449822, 'LY'), (5.425930688613129, 'JO'), (5.441199684293607, 'QA'), (5.4696040156162855, 'VG'), (5.483638743455497, 'PS'), (5.510182767624021, 'SD'), (5.542372320354822, 'DO'), (5.554105859467203, 'IQ'), (5.56179889198682, 'DZ'), (5.590808885874173, 'RE'), (5.605101143359718, 'JE'), (5.608819776714514, 'SA'), (5.6150413440084, 'EG'), (5.627722772277227, 'MO'), (5.632383124287343, 'TF'), (5.638857551660568, 'KP'), (5.640625, 'GG'), (5.642732716385411, 'AL'), (5.661649214659686, 'BH'), (5.6750982737993505, 'BS'), (5.697569248162804, 'CV'), (5.712365591397849, 'TC'), (5.723943661971831, 'SS'), (5.729207887016442, 'NI'), (5.739795918367347, 'ST'), (5.752458351233949, 'CU'), (5.753731343283582, 'AI'), (5.755834829443447, 'MF'), (5.758101851851852, 'KY'), (5.760401721664276, 'SH'), (5.788104089219331, 'IO'), (5.791485561178923, 'MN'), (5.792709705753184, 'KW'), (5.7974543043302775, 'MA'), (5.822173133471993, 'MX'), (5.825162594960923, 'AE'), (5.82630979498861, 'GW'), (5.829364580452111, 'HN'), (5.829557337051237, 'NC'), (5.847201884510091, 'SV'), (5.847727272727273, 'BQ'), (5.857397151898734, 'EH'), (5.867538715982559, 'GQ'), (5.89058524173028, 'VC'), (5.898466317219957, 'GU'), (5.898838698282333, 'UY'), (5.902524955960071, 'AG'), (5.907273288582764, 'PK'), (5.9116639884745386, 'PT'), (5.916597164303586, 'FK'), (5.9173153433662, 'MR'), (5.926756547949379, 'NG'), (5.9276672694394215, 'SX'), (5.940161789198192, 'GP'), (5.942797132897659, 'VE'), (5.949275362318841, 'CC'), (5.9600609862224045, 'CA'), (5.966404899790788, 'ET'), (5.975516314000101, 'PA'), (5.980873110684049, 'MM'), (5.983159117305458, 'BZ'), (5.994756323257248, 'ER'), (6.0040212480762545, 'PY'), (6.011849503754859, 'HT'), (6.02623688155922, 'SC'), (6.034936565044499, 'IL'), (6.036269430051814, 'CX'), (6.041420118343195, 'GM'), (6.058588548601864, 'BM'), (6.062419516382888, 'CO'), (6.067484662576687, 'IM'), (6.073638455637944, 'MU'), (6.075977030200172, 'AR'), (6.0792707906595655, 'GT'), (6.079733435692054, 'ES'), (6.088670930116969, 'TD'), (6.089855072463768, 'AW'), (6.094443638473814, 'MQ'), (6.099313446969697, 'CF'), (6.108322738331167, 'FR'), (6.120908603112144, 'CM'), (6.1210117003617945, 'BR'), (6.1223776223776225, 'TK'), (6.132044329167649, 'LR'), (6.152633409723359, 'CL'), (6.154275092936803, 'NU'), (6.160657811511702, 'GD'), (6.166180758017493, 'MC'), (6.16966966966967, 'CR'), (6.170225747406955, 'GS'), (6.174195369847544, 'MP'), (6.182939362795478, 'PF'), (6.192118226600985, 'HM'), (6.197183098591549, 'TT'), (6.209813874788494, 'MS'), (6.219101123595506, 'CK'), (6.222830336200157, 'JM'), (6.233941605839416, 'SN'), (6.235955056179775, 'PN'), (6.237983587338804, 'DM'), (6.241835834068843, 'KN'), (6.260107049311013, 'XK'), (6.266165059957677, 'PG'), (6.268665650848933, 'MK'), (6.297898784324388, 'SO'), (6.306439674315322, 'FM'), (6.310868480851299, 'NE'), (6.316106531388713, 'LC'), (6.3203971119133575, 'CW'), (6.321779454531164, 'SI'), (6.328964432383103, 'MY'), (6.335731414868105, 'MH'), (6.336354481369587, 'WF'), (6.3375, 'VA'), (6.348687596500257, 'DJ'), (6.349656750572082, 'BB'), (6.3630366855688, 'GA'), (6.373229728036095, 'GF'), (6.3732912723449004, 'UM'), (6.3760905884536845, 'SG'), (6.380370596619833, 'VI'), (6.387096774193548, 'BV'), (6.414524388948664, 'AU'), (6.419220804614557, 'ME'), (6.449824530229665, 'PR'), (6.477141017385705, 'WS'), (6.505201342281879, 'CG'), (6.5059870444284496, 'EC'), (6.5105740181268885, 'NR'), (6.521105141980046, 'YT'), (6.523832450649976, 'BN'), (6.525710273306687, 'SL'), (6.529416950945751, 'PH'), (6.5421845515649615, 'NZ'), (6.55646682522759, 'TL'), (6.556528994576554, 'PW'), (6.560393656188049, 'BO'), (6.564742589703588, 'GI'), (6.580899763220205, 'TO'), (6.58681421446384, 'ML'), (6.5997809946049895, 'CD'), (6.602175969725638, 'AS'), (6.6044701880495476, 'IT'), (6.6059171597633135, 'BT'), (6.608260325406758, 'TV'), (6.609498327759197, 'KG'), (6.6122634643377, 'EE'), (6.617981679879422, 'US'), (6.631906496660595, ''), (6.636917904813459, 'MZ'), (6.696569294211629, 'KE'), (6.69918450404688, 'CZ'), (6.699398108340499, 'GY'), (6.706584180291649, 'HR'), (6.719387755102041, 'NF'), (6.7203587806073894, 'RS'), (6.7221558928876, 'SK'), (6.73710838684569, 'BA'), (6.745988267804334, 'RO'), (6.764326264126477, 'GB'), (6.772658566362421, 'BE'), (6.777431370961211, 'TZ'), (6.799083269671505, 'KI'), (6.826690055323168, 'AQ'), (6.848221266614543, 'JP'), (6.86865606621651, 'SB'), (6.869835077141337, 'VU'), (6.910169889873758, 'AO'), (6.910828025477707, 'SM'), (6.915529354760559, 'BF'), (6.922410216218708, 'CI'), (6.923335771762985, 'TG'), (6.964752531514776, 'TW'), (6.965925567907202, 'MW'), (6.974885844748859, 'SR'), (6.984580126754188, 'UG'), (7.007058823529412, 'MV'), (7.013322949406169, 'ZW'), (7.048551598964617, 'PE'), (7.05673304218919, 'TR'), (7.063499178245928, 'BJ'), (7.072072419241265, 'ID'), (7.080565001307874, 'MD'), (7.09546539379475, 'GN'), (7.097248380724884, 'GH'), (7.102440202947572, 'LV'), (7.105675083218316, 'GR'), (7.138313667265765, 'CY'), (7.148936170212766, 'SZ'), (7.190359762486902, 'KR'), (7.19118936787425, 'BI'), (7.206765226257234, 'ZM'), (7.217553945503229, 'BG'), (7.232082320823208, 'FJ'), (7.259305404142657, 'TJ'), (7.27295534370296, 'LS'), (7.294048204623709, 'DK'), (7.320386579139314, 'BW'), (7.355654952076677, 'PL'), (7.360461974875051, 'UZ'), (7.389836289222374, 'AZ'), (7.40767656633191, 'IN'), (7.40986646884273, 'RW'), (7.43136678810671, 'CH'), (7.440738112136267, 'KM'), (7.475953998954521, 'TM'), (7.494062188378207, 'BD'), (7.494895694629383, 'LI'), (7.495320810610651, 'AM'), (7.5, 'YU'), (7.523667621776505, 'IE'), (7.598183652875883, 'NA'), (7.833129303749043, 'GE'), (7.855672850564842, 'ZA'), (7.890832067557587, 'KZ'), (7.89971789003034, 'NL'), (7.9832234871180345, 'LU'), (7.985600419851084, 'NP'), (8.068295391449196, 'GL'), (8.078216462722914, 'RU'), (8.095657938920125, 'SE'), (8.162683248522361, 'CN'), (8.198620504191908, 'DE'), (8.238038501074666, 'LT'), (8.299113419217857, 'HU'), (8.376664984863774, 'BY'), (8.496474651746974, 'AT'), (8.502604634453027, 'UA'), (8.54958567228014, 'AX'), (8.640312341289995, 'LK'), (8.75, 'CS'), (9.025132914451426, 'FO'), (9.331491251502605, 'MG'), (9.333333333333334, 'AN'), (9.415802075019952, 'IS'), (9.494112110549002, 'FI'), (9.627222265412422, 'NO'), (10.635922330097088, 'SJ')]
```



## Part II. Visualization

### All cities with population more than 5000

![](https://i.loli.net/2019/05/19/5ce166929c7fa74718.jpg)

The figure above show all cities with population more than 500 (total ~180,000 cities) scattered onto a dark background, with each point represents a city. This figure gives a sense on where geographic information is densely aggregated or recorded and where there are not. It seems that western european area holds the most densely distributed populated cities. Other populated area includes USA, Central American and Southeast China.

```javascript
    d3.text("cities500.csv").then(function (text) {
        let rows = d3.tsvParseRows(text)
        rows.forEach(function (d) {
            var p = projection([+d[5], +d[4]]);
            if (p) d.x = Math.round(p[0]), d.y = Math.round(p[1]);
        })
        init();
        function init() {
            
            var canvas = d3.select("body").insert("canvas", "input")
                .attr("width", width)
                .attr("height", height)
            var context = canvas.node().getContext("2d");
            context.fillStyle = "#222222";
            context.globalCompositeOperation = 'lighter';
            context.globalAlpha = .8;
            rows.forEach(function (d) {
                context.fillStyle = "#497591";
                context.fillRect(d.x, d.y, 1, 1);
            });
        }
    });
```


### Cities with Longer Names

![](https://i.loli.net/2019/05/19/5ce16692f159c77451.jpg)

Cities are represented with different colors on this map, and to avoid confusing mixed colors, color *[blend modes](https://en.wikipedia.org/wiki/Blend_modes)* are set to Normal, i.e. no blending. In this figure, blue dot means a city that has short words in its name (e.g. Ho Chi Minh City), and yellow dot indicates long words (e.g. Vladivostok).

To design a proper `words_length -> color` projection function, we firstly investigated the distribution of word lengths. The median word length is around 6 letters, with a minimun of 1 letter and maximum of over 20 letters. This is like a normal distribution with *skewed* (or imbalanced) two sides. *Log-normal distribution*, in this case, fits the model.

![450px-PDF-log_normal_distributions.svg.png](https://i.loli.net/2019/05/19/5ce16c3d7c34b27321.png)

Above is its PDF (Probability density function) plotted. To transform the distribution into a color projection function, we need its CDF (Cumulative distribution function) expressions:
$$
CDF(x, \mu, \sigma) = \frac12 + \frac12\operatorname{erf}\Big[\frac{\ln x-\mu}{\sqrt{2}\sigma}\Big]
$$
The corresponding part of code is implemented as below:

```js
    function erf(x) {
        let m = 1.00;
        let s = 1.00;
        let sum = x * 1.0;
        for (let i = 1; i < 50; i++) {
            m *= i;
            s *= -1;
            sum += (s * Math.pow(x, 2.0 * i + 1.0)) / (m * (2.0 * i + 1.0));
        }
        return 2 * sum / Math.sqrt(3.14159265358979);
    }

    function logNormalCDF(x, mu, sigma) {
        let par = (Math.log(x) - mu) / (Math.sqrt(2) * sigma)
        return 0.5 + 0.5 * erf(par)
    }

    const projectColor = (x) => Math.round(logNormalCDF(x/5, 0, 1)*255)
```

And despite its ugliness, the result color is concatenated from strings:

```js
context.fillStyle = 'rgb(' + projectColor(wordLength) + ',' + projectColor(wordLength) + ',' + (255 - projectColor(wordLength)) + ')'
```

### Cities with More Words

![](https://i.loli.net/2019/05/19/5ce166929b17333331.jpg)

This is similar to the previous plot, whereas a red dot indicates a city name consists many words, and a green dot indicates the contrary.

### Experimenting with Placenames in China

![cn-1.png](https://i.loli.net/2019/05/19/5ce1725ad75fc88754.png)

```js
            rows.forEach(function (d) {
                let name = d[2]
                let pattern = /DIAN$/i
                if (pattern.test(name)) {
                    context.fillStyle = "#497591";
                    context.fillRect(d.x, d.y, 1, 1);
                }
            });
```

